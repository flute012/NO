<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>改進的文件比較工具</title>
    <style>
        #comparison {
            display: flex;
            flex-wrap: wrap;
        }
        .page-content {
            border: 1px solid #ccc;
            margin: 10px;
            padding: 10px;
            width: calc(50% - 22px);
            overflow-x: auto;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <h1>改進的文件比較工具</h1>
    <div>
        <label for="fileSelect">選擇要比較的文件：</label>
        <select id="fileSelect" multiple>
            <option value="L1.html">L1.html</option>
            <option value="L2.html">L2.html</option>
            <!-- 可以根據需要添加更多選項 -->
        </select>
    </div>
    <div>
        <label for="elementSelect">選擇要比較的元素：</label>
        <select id="elementSelect">
            <option value="a1">a1</option>
            <option value="a2">a2</option>
        </select>
        <button onclick="compareElements()">比較</button>
    </div>
    <div id="comparison"></div>

    <script>
        let loadedFiles = {};

        async function loadFile(fileName) {
            if (loadedFiles[fileName]) {
                return loadedFiles[fileName];
            }
            try {
                const response = await fetch(fileName);
                const content = await response.text();
                loadedFiles[fileName] = content;
                return content;
            } catch (error) {
                console.error(`無法載入文件 ${fileName}:`, error);
                return null;
            }
        }

        async function compareElements() {
            const fileSelect = document.getElementById('fileSelect');
            const elementSelect = document.getElementById('elementSelect');
            const comparisonDiv = document.getElementById('comparison');
            const selectedFiles = Array.from(fileSelect.selectedOptions).map(option => option.value);
            const selectedElement = elementSelect.value;

            comparisonDiv.innerHTML = '';

            for (const fileName of selectedFiles) {
                const content = await loadFile(fileName);
                if (!content) continue;

                const parser = new DOMParser();
                const doc = parser.parseFromString(content, 'text/html');
                const element = doc.getElementById(selectedElement);

                const pageContent = document.createElement('div');
                pageContent.className = 'page-content';

                if (element) {
                    pageContent.innerHTML = `<h2>${fileName} - ${selectedElement}</h2><pre>${escapeHTML(element.outerHTML)}</pre>`;
                } else {
                    pageContent.innerHTML = `<h2>${fileName}</h2><p>找不到 id 為 ${selectedElement} 的元素</p>`;
                }

                comparisonDiv.appendChild(pageContent);
            }
        }

        function escapeHTML(html) {
            return html
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
    </script>
</body>
</html>